---
title: "7:55:19 AM - November 10, 2025"
date: 2025-11-10T06:55:19.690Z
timestamp: 1762757719690
---

## Project Notes

Blossom URL handling fix complete:

**Root Cause**: We were only parsing `url` field from Blossom server and trying to construct MP4 URLs by regex-parsing HLS URLs. This was wrong - the server provides ALL URLs directly.

**Server Response Structure** (from FLUTTER_INTEGRATION_GUIDE.md):
```json
{
  "url": "https://stream.divine.video/12345/playlist.m3u8",  // HLS
  "fallbackUrl": "https://cdn.divine.video/abc123.mp4",       // R2 MP4  
  "streaming": {
    "status": "processing" | "ready",
    "hlsUrl": "https://stream.divine.video/12345/playlist.m3u8",
    "mp4Url": "https://stream.divine.video/12345/play.mp4",    // BunnyStream MP4
    "thumbnailUrl": "https://stream.divine.video/12345/thumbnail.jpg"
  }
}
```

**Solution Implemented**:
1. Updated `BlossomUploadResult` with all URL fields
2. Added `streamingMp4Url`, `streamingHlsUrl`, `fallbackUrl` to `PendingUpload` (HiveFields 21-23)
3. Updated publisher to use stored URLs instead of constructing them
4. Prioritization in imeta tags: streamingMp4Url (110) > fallbackUrl (100) > streamingHlsUrl (90)

**Key Insight**: For short videos, MP4 scores higher than HLS in video_event.dart scoring. This ensures proper playback without OSStatus -12847 errors.

Committed: 7ce65e1
